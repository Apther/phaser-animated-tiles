!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("AnimatedTiles",[],t):"object"==typeof exports?exports.AnimatedTiles=t():e.AnimatedTiles=t()}("undefined"!=typeof self?self:this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var a=n[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=function(e){function t(e,n){i(this,t);var r=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return r.map=null,r.animatedTiles=[],r.rate=1,r.active=!1,r.activeLayer=[],r.followTimeScale=!0,e.sys.settings.isBooted||e.sys.events.once("boot",r.boot,r),r}return r(t,e),o(t,[{key:"boot",value:function(){var e=this.systems.events;e.on("postupdate",this.postUpdate,this),e.on("shutdown",this.shutdown,this),e.on("destroy",this.destroy,this)}},{key:"init",value:function(e){var t=this.getAnimatedTiles(e),n={map:e,animatedTiles:t,active:!0,rate:1,activeLayer:[]};e.layers.forEach(function(){return n.activeLayer.push(!0)}),this.animatedTiles.push(n),1===this.animatedTiles.length&&(this.active=!0)}},{key:"setRate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null===t)null===n?this.rate=e:this.animatedTiles[n].rate=e;else{var i=function(n){n.forEach(function(n){n.index===t&&(n.rate=e)})};null===n?this.animatedTiles.forEach(function(e){i(e.animatedTiles)}):i(this.animatedTiles[n].animatedTiles)}}},{key:"resetRates",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null===e?(this.rate=1,this.animatedTiles.forEach(function(e){e.rate=1,e.animatedTiles.forEach(function(e){e.rate=1})})):(this.animatedTiles[e].rate=1,this.animatedTiles[e].animatedTiles.forEach(function(e){e.rate=1}))}},{key:"resume",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=null===n?this:this.animatedTiles[n];null===t?i.active=!0:(i.activeLayer[t]=!0,i.animatedTiles.forEach(function(n){e.updateLayer(n,n.tiles[t])}))}},{key:"pause",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=null===t?this:this.animatedTiles[t];null===e?n.active=!1:n.activeLayer[e]=!1}},{key:"postUpdate",value:function(e,t){var n=this;if(this.active){var i=t*this.rate*(this.followTimeScale?this.scene.time.timeScale:1);this.animatedTiles.forEach(function(e){if(e.active){var t=i*e.rate;e.animatedTiles.forEach(function(i){if(i.next-=t*i.rate,i.next<0){var a=i.currentFrame,r=i.frames[a].tileid,o=a+1;o>i.frames.length-1&&(o=0),i.next=i.frames[o].duration,i.currentFrame=o,i.tiles.forEach(function(t,a){e.activeLayer[a]&&n.updateLayer(i,t,r)})}})}})}}},{key:"updateLayer",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,i=[],a=e.frames[e.currentFrame].tileid;t.forEach(function(e){n>-1&&(null===e||e.index!==n)?i.push(e):e.index=a}),i.forEach(function(e){var n=t.indexOf(e);n>-1?t.splice(n,1):console.error("This shouldn't happen. Not at all. Blame Phaser Animated Tiles plugin. You'll be fine though.")})}},{key:"shutdown",value:function(){}},{key:"destroy",value:function(){this.shutdown(),this.scene=void 0}},{key:"getAnimatedTiles",value:function(e){var t=this,n=[];return e.tilesets.forEach(function(t){var i=t.tileData;Object.keys(i).forEach(function(a){if(a=parseInt(a),i[a].hasOwnProperty("animation")){var r={index:a+t.firstgid,frames:[],currentFrame:0,tiles:[],rate:1};i[a].animation.forEach(function(e){var n={duration:e.duration,tileid:e.tileid+t.firstgid};r.frames.push(n)}),r.next=r.frames[0].duration,e.layers.forEach(function(e){if("StaticTilemapLayer"===e.tilemapLayer.type)return void r.tiles.push([]);var n=[];e.data.forEach(function(e){e.forEach(function(e){e.index-t.firstgid===a&&n.push(e)})}),r.tiles.push(n)}),n.push(r)}})}),e.layers.forEach(function(e,n){t.activeLayer[n]=!0}),n}},{key:"putTileAt",value:function(e,t,n,i){}},{key:"updateAnimatedTiles",value:function(){var e=null;null===e&&(e=[],this.animatedTiles.forEach(function(t){e.push(t)})),e.forEach(function(e){e.animatedTiles.forEach(function(t){t.tiles.forEach(function(n,i){if("StaticTilemapLayer"!==e.map.layers[i].type)for(var a=0;a<10;a++)for(var r=0;r<10;r++){var o=e.map.layers[i].data[a][r];o.index==t.index&&(-1===n.indexOf(o)&&n.push(o),o.index=t.frames[t.currentFrame].tileid)}})})})}}]),t}(Phaser.Plugins.ScenePlugin);s.register=function(e){e.register("AnimatedTiles",s,"animatedTiles")},e.exports=s}])});