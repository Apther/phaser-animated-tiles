!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("AnimatedTiles",[],e):"object"==typeof exports?exports.AnimatedTiles=e():t.AnimatedTiles=e()}("undefined"!=typeof self?self:this,function(){return function(t){function e(n){if(i[n])return i[n].exports;var s=i[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,e),s.l=!0,s.exports}var i={};return e.m=t,e.c=i,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,i){"use strict";/**
* @author       Niklas Berg <nkholski@niklasberg.se>
* @copyright    2018 Niklas Berg
* @license      {@link https://github.com/nkholski/phaser3-animated-tiles/blob/master/LICENSE|MIT License}
*/
var n=function(t){this.scene=t,this.systems=t.sys,this.map=null,this.animatedTiles=[],this.rate=1,this.active=!1,this.activeLayer=[],t.sys.settings.isBooted||t.sys.events.once("boot",this.boot,this)};n.register=function(t){t.register("AnimatedTiles",n,"animatedTiles")},n.prototype={boot:function(){var t=this.systems.events;t.on("postupdate",this.postUpdate,this),t.on("shutdown",this.shutdown,this),t.on("destroy",this.destroy,this)},init:function(t){var e=this;this.map=t,this.map.tilesets.forEach(function(t){e.animatedTiles=e.getAnimatedTiles(t.tileData)}),this.active=!0},setRate:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e||(this.rate=t),this.animatedTiles.forEach(function(i){i.index===e&&(i.rate=t)})},resetRates:function(){this.rate=1,this.animatedTiles.forEach(function(t){t.rate=1})},resume:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;console.log("RESUME",e),null===e?this.active=!0:(this.activeLayer[e]=!0,this.animatedTiles.forEach(function(i){t.updateLayer(i,i.tiles[e])}))},pause:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null===t?this.active=!1:this.activeLayer[t]=!1},postUpdate:function(t,e){var i=this;this.active&&this.animatedTiles.forEach(function(t){if(t.next-=e*i.rate*t.rate,t.next<0){var n=t.currentFrame,s=t.frames[n].tileid,a=n+1;a>t.frames.length-1&&(a=0),t.next=t.frames[a].duration,t.currentFrame=a,t.tiles.forEach(function(e,n){i.activeLayer[n]&&i.updateLayer(t,e,s)})}})},updateLayer:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,n=[],s=t.frames[t.currentFrame].tileid;e.forEach(function(t){i>-1&&(null===t||t.index!==i)?n.push(t):t.index=s}),n.forEach(function(t){var i=e.indexOf(t);i>-1?e.splice(i,1):console.error("This shouldn't happen. Not at all. Blame Phaser Animated Tiles plugin. You'll be fine though.")})},shutdown:function(){},destroy:function(){this.shutdown(),this.scene=void 0},getAnimatedTiles:function(t){var e=this,i=[];return Object.keys(t).forEach(function(n){if(n=parseInt(n),t[n].hasOwnProperty("animation")){var s={index:n,frames:[],currentFrame:0,tiles:[],rate:1};t[n].animation.forEach(function(t){t.tileid++,s.frames.push(t)}),s.next=s.frames[0].duration,e.map.layers.forEach(function(t){var e=[];t.data.forEach(function(t){t.forEach(function(t){t.index-1===n&&e.push(t)})}),s.tiles.push(e)}),i.push(s)}}),this.map.layers.forEach(function(t,i){e.activeLayer[i]=!0}),i}},n.prototype.constructor=n,t.exports=n}])});